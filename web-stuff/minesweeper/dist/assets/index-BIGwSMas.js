(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const f of r.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&o(f)}).observe(document,{childList:!0,subtree:!0});function i(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(l){if(l.ep)return;l.ep=!0;const r=i(l);fetch(l.href,r)}})();const K=document.querySelector(".buttons > .reset");K.onclick=()=>Z();const G=document.querySelector(".buttons > .solve");G.onclick=()=>te();const M=document.querySelector(".gameover"),J=document.querySelector(".flagcounter > .counter"),c=document.querySelector(".main > .game > canvas"),s=c.getContext("2d",{alpha:!1}),y=window.devicePixelRatio||1;s.scale(y,y);s.imageSmoothingEnabled=!1;s.textRendering="optimizeLegibility";window.debug=!1;window.verbose=!1;const E=parseFloat(getComputedStyle(document.documentElement).fontSize),A=Math.min(window.screen.width,window.innerWidth,window.innerHeight-4*E-5*E);[c.width,c.height]=[A*y,A*y];c.style.width=A+"px";c.style.height=A+"px";const F=Math.min(c.clientWidth,c.clientHeight)*y,n=20,a=Math.floor(F/n),u=Array(n*n).fill(0),g=Array(n*n).fill(!1),d=Array(n*n).fill(!1),v=Array(n*n).fill(0),Q=n*a,p=(F-Q)/2/y;let b=!1;const H=64;let L=!0,X=!1,C=0,W=0,Y=-1;s.font=`${a}px sans-serif`;s.textBaseline="top";s.textAlign="center";const _={0:"transparent",1:"navy",2:"green",3:"maroon",4:"purple",5:"gold",6:"cyan",7:"olive",8:"grey"};function x(){s.fillStyle="#1a1a1a",s.fillRect(0,0,F,F);for(let e=0;e<n;e++)for(let t=0;t<n;t++){const[i,o]=ee(t,e);if(s.fillStyle=(e+t)%2===0?"bisque":"burlywood",s.fillRect(i,o,a,a),u[e*n+t]!==-1){s.fillStyle=_[u[e*n+t]];const[l,r]=I(u[e*n+t]);s.fillText(u[e*n+t],i+a/2,o+a/2+r)}else s.fillStyle="maroon",s.fillRect(i,o,a,a);if(g[e*n+t]||(s.fillStyle=(e+t)%2===0?"#56B740":"#238223",Y===e*n+t&&(s.fillStyle=(e+t)%2===0?"#8CCC7A":"#7FC76B"),s.fillRect(i,o,a,a)),d[e*n+t]){s.fillStyle="red",s.font=`${a*.8}px sans-serif`;const[l,r]=I(u[e*n+t]);s.fillText("ðŸš©",i+a/2,o+a/2+r),s.font=`${a}px sans-serif`}window.debug&&X&&(s.fillStyle="black",s.textAlign="left",s.font=`${a*.4}px sans-serif`,v[e*n+t]>0&&s.fillText(v[e*n+t],i+2,o+2),s.font=`${a}px sans-serif`,s.textAlign="center"),J.innerHTML=H-d.reduce((l,r)=>l+r)}}function ee(e,t){return[p+e*a,p+t*a]}function B(e){const t=e%n,i=(e-t)/n;return[t,i]}function I(e){const t=s.measureText(e),i=t.actualBoundingBoxAscent-t.actualBoundingBoxDescent;return[t.width/2,i/2]}function z(){for(let e=0;e<H;e++){let t=Math.floor(Math.random()*n*n);u[t]===-1?e--:u[t]=-1}for(let e=0;e<n;e++)for(let t=0;t<n;t++)u[e*n+t]!==-1&&(u[e*n+t]=O(t,e).reduce((i,o)=>i+(u[o[1]*n+o[0]]===-1),0))}function O(e,t){let i=Array(9),o=0;for(let l=-1;l<=1;l++)for(let r=-1;r<=1;r++)i[o]=[e+r,t+l],o++;return i[4]=[-1,-1],i.filter(l=>l[0]>=0&&l[1]>=0&&l[0]<=n-1&&l[1]<=n-1)}function R(e,t){const i=(e-(c.clientLeft+p/y))/(c.clientWidth-p*2),o=(t-(c.clientTop+p/y))/(c.clientHeight-p*2);return 0<i&&i<1&&0<o&&o<1}function P(e,t){const i=Math.floor((e-(c.clientLeft+p/y))/(c.clientWidth-p*2)*n),o=Math.floor((t-(c.clientTop+p/y))/(c.clientHeight-p*2)*n);return(i<0||o<0||i>n-1||o>n-1)&&console.log("POINTER ERROR OUT OF BOUNDS, pos: ",i,o),[i,o]}c.onclick=e=>{if(e.preventDefault(),b&&V(),!R(e.offsetX,e.offsetY))return;const[t,i]=P(e.offsetX,e.offsetY);N(t,i),x()};c.oncontextmenu=e=>{if(e.preventDefault(),!R(e.offsetX,e.offsetY))return;const[t,i]=P(e.offsetX,e.offsetY);k(t,i),x()};c.onpointermove=e=>{if(e.pointerType==="mouse"){if(b)return Y=0;if(R(e.offsetX,e.offsetY)){const[t,i]=P(e.offsetX,e.offsetY);Y=i*n+t,requestAnimationFrame(x)}else D()}};c.onpointerleave=D;function N(e,t){if(b||d[t*n+e]===!0)return;if(L){for(let l=0;l<1e3&&u[t*n+e]!==0;l++)window.verbose&&console.log(`regen attempt #${l}.`),Z(),window.verbose&&l===0&&console.log("(just making sure you don't lose on the first turn)");L=!1}if(u[t*n+e]===-1){U(!1);return}let i=new Set().add(t*n+e),o=new Set;for(let l of i){if(u[l]===0)for(let r of O(...B(l)).map(f=>f[1]*n+f[0]))!o.has(r)&&u[r]!==-1&&i.add(r);o.add(l)}for(let l of i)g[l]=!0;j()}function k(e,t){b||g[t*n+e]!==!0&&(d[t*n+e]=!d[t*n+e],j())}function D(){Y=-1,requestAnimationFrame(x)}function j(){let e=!0,t=!0;for(let o=0;o<u.length;o++)u[o]!==-1&&g[o]!==!0&&(e=!1);for(let o=0;o<u.length;o++)u[o]===-1&&d[o]!==!0&&(t=!1);t=t&&H-d.reduce((o,l)=>o+l)>=0,(e||t)&&U(!0)}function U(e=!1){e?(M.innerHTML="You Win!",C++):W++,window.debug&&console.log(`Win rate: ${C}/${C+W}, ${Math.round(C*1e4/(C+W))/100}%`),c.style.filter="blur(5px)",M.style.display="block",b=!0}function V(){c.style="",c.style.width=A+"px",c.style.height=A+"px",M.style="",M.innerHTML="Game Over"}function Z(){u.fill(0),g.fill(!1),d.fill(!1),v.fill(0),z(),V(),fe(),x(),b=!1,L=!0}function te(){if(!b){if(X)return re();requestAnimationFrame(L?()=>{N(Math.floor((n-1)/2),Math.floor((n-1)/2)),x(),requestAnimationFrame(()=>q(0,!0))}:()=>q(0,!0))}}function q(e=0,t=!1){let i=g.reduce((r,f)=>r+f)+d.reduce((r,f)=>r+f);for(let r=0;r<n;r++)for(let f=0;f<n;f++)if(g[r*n+f]===!0&&u[r*n+f]>0){let h=u[r*n+f],w=O(f,r),T=w.filter(m=>!g[m[1]*n+m[0]]),S=w.filter(m=>d[m[1]*n+m[0]]);if(h===S.length)for(let m of T.filter($=>!d[$[1]*n+$[0]]))N(m[0],m[1])}x();for(let r=0;r<n;r++)for(let f=0;f<n;f++)if(g[r*n+f]===!0&&u[r*n+f]>0){let h=u[r*n+f],T=O(f,r).filter(S=>!g[S[1]*n+S[0]]);if(h===T.length)for(let S of T.filter(m=>!d[m[1]*n+m[0]]))k(S[0],S[1])}x();let l=g.reduce((r,f)=>r+f)+d.reduce((r,f)=>r+f)-i;return l===0&&!b&&le(),l===0||b?1:(t&&requestAnimationFrame(()=>q(e+1,!0)),0)}function ne(e){let t=0,i=!1;for(let o=1;o<e.length;o++)!i&&e[o]>0&&(i=!0,t=o),e[o]>0&&e[o]<e[t]&&(t=o);return t}function ie(e){let t=0;for(let i=1;i<e.length;i++)e[i]>e[t]&&(t=i);return t}function re(){requestAnimationFrame(()=>{oe(!0),q(0,!0)})}function oe(e=!1){v.fill(0);for(let t=0;t<n;t++)for(let i=0;i<n;i++)if(g[t*n+i]===!0&&u[t*n+i]>0){let o=u[t*n+i],l=O(i,t),r=l.filter(h=>!g[h[1]*n+h[0]]),f=l.filter(h=>d[h[1]*n+h[0]]);if(r.length>f.length){let h=r.filter(w=>!d[w[1]*n+w[0]]);for(let w of h)v[w[1]*n+w[0]]+=o/h.length}}if(e){const t=ie(v);k(...B(t))}else{const t=ne(v);N(...B(t))}x()}function le(){G.innerHTML="Guess",G.style.background="coral",X=!0}function fe(){G.innerHTML="Solve",G.style="",X=!1}z();console.time("render");x();console.timeEnd("render");
